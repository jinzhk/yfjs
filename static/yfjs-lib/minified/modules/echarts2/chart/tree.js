define("echarts2/chart/tree",["require","./base","../util/shape/Icon","zrender2/shape/Image","zrender2/shape/Line","zrender2/shape/BezierCurve","../layout/Tree","../data/Tree","../config","../util/ecData","zrender2/config","zrender2/tool/event","zrender2/tool/util","../chart"],function(a){function b(a,b,d,e,f){c.call(this,a,b,d,e,f),this.refresh(e)}var c=a("./base"),d=.618,e=a("../util/shape/Icon"),f=a("zrender2/shape/Image"),g=a("zrender2/shape/Line"),h=a("zrender2/shape/BezierCurve"),i=a("../layout/Tree"),j=a("../data/Tree"),k=a("../config");k.tree={zlevel:1,z:2,calculable:!1,clickable:!0,rootLocation:{},orient:"vertical",symbol:"circle",symbolSize:20,nodePadding:30,layerPadding:100,itemStyle:{normal:{label:{show:!0},lineStyle:{width:1,color:"#777",type:"curve"}},emphasis:{}}};var l=a("../util/ecData"),m=(a("zrender2/config"),a("zrender2/tool/event"),a("zrender2/tool/util"));return b.prototype={type:k.CHART_TYPE_TREE,_buildShape:function(a,b){var c=a.data[0];this.tree=j.fromOptionData(c.name,c.children),this.tree.root.data=c,this._setTreeShape(a),this.tree.traverse(function(c){this._buildItem(c,a,b),c.children.length>0&&this._buildLink(c,a)},this);var d=!0===a.roam||"move"===a.roam,e=!0===a.roam||"scale"===a.roam;this.zr.modLayer(this.getZlevelBase(),{panable:d,zoomable:e}),(this.query("markPoint.effect.show")||this.query("markLine.effect.show"))&&this.zr.modLayer(k.EFFECT_ZLEVEL,{panable:d,zoomable:e}),this.addShapeList()},_buildItem:function(a,b,c){var d=[a.data,b],g=this.deepQuery(d,"symbol"),h=this.deepMerge(d,"itemStyle.normal")||{},i=this.deepMerge(d,"itemStyle.emphasis")||{},j=h.color||this.zr.getColor(),k=i.color||this.zr.getColor(),m=-a.layout.angle||0;a.id===this.tree.root.id&&(m=0);var n="right";Math.abs(m)>=Math.PI/2&&Math.abs(m)<3*Math.PI/2&&(m+=Math.PI,n="left");var o=[m,a.layout.position[0],a.layout.position[1]],p=new e({zlevel:this.getZlevelBase(),z:this.getZBase()+1,rotation:o,clickable:this.deepQuery(d,"clickable"),style:{x:a.layout.position[0]-.5*a.layout.width,y:a.layout.position[1]-.5*a.layout.height,width:a.layout.width,height:a.layout.height,iconType:g,color:j,brushType:"both",lineWidth:h.borderWidth,strokeColor:h.borderColor},highlightStyle:{color:k,lineWidth:i.borderWidth,strokeColor:i.borderColor}});p.style.iconType.match("image")&&(p.style.image=p.style.iconType.replace(new RegExp("^image:\\/\\/"),""),p=new f({rotation:o,style:p.style,highlightStyle:p.highlightStyle,clickable:p.clickable,zlevel:this.getZlevelBase(),z:this.getZBase()})),this.deepQuery(d,"itemStyle.normal.label.show")&&(p.style.text=null==a.data.label?a.id:a.data.label,p.style.textPosition=this.deepQuery(d,"itemStyle.normal.label.position"),"radial"===b.orient&&"inside"!==p.style.textPosition&&(p.style.textPosition=n),p.style.textColor=this.deepQuery(d,"itemStyle.normal.label.textStyle.color"),p.style.textFont=this.getFont(this.deepQuery(d,"itemStyle.normal.label.textStyle")||{})),this.deepQuery(d,"itemStyle.emphasis.label.show")&&(p.highlightStyle.textPosition=this.deepQuery(d,"itemStyle.emphasis.label.position"),p.highlightStyle.textColor=this.deepQuery(d,"itemStyle.emphasis.label.textStyle.color"),p.highlightStyle.textFont=this.getFont(this.deepQuery(d,"itemStyle.emphasis.label.textStyle")||{})),l.pack(p,b,c,a.data,0,a.id),this.shapeList.push(p)},_buildLink:function(a,b){var c=b.itemStyle.normal.lineStyle;if("broken"===c.type)return void this._buildBrokenLine(a,c,b);for(var d=0;d<a.children.length;d++){var e=a.layout.position[0],f=a.layout.position[1],g=a.children[d].layout.position[0],h=a.children[d].layout.position[1];switch(c.type){case"curve":this._buildBezierCurve(a,a.children[d],c,b);break;case"broken":break;default:var i=this._getLine(e,f,g,h,c);this.shapeList.push(i)}}},_buildBrokenLine:function(a,b,c){var e=m.clone(b);e.type="solid";var f=[],g=a.layout.position[0],h=a.layout.position[1],i=c.orient,j=a.children[0].layout.position[1],k=g,l=h+(j-h)*(1-d),n=a.children[0].layout.position[0],o=l,p=a.children[a.children.length-1].layout.position[0],q=l;if("horizontal"===i){var r=a.children[0].layout.position[0];k=g+(r-g)*(1-d),l=h,n=k,o=a.children[0].layout.position[1],p=k,q=a.children[a.children.length-1].layout.position[1]}f.push(this._getLine(g,h,k,l,e)),f.push(this._getLine(n,o,p,q,e));for(var s=0;s<a.children.length;s++)r=a.children[s].layout.position[0],j=a.children[s].layout.position[1],"horizontal"===i?o=j:n=r,f.push(this._getLine(n,o,r,j,e));this.shapeList=this.shapeList.concat(f)},_getLine:function(a,b,c,d,e){return a===c&&(a=c=this.subPixelOptimize(a,e.width)),b===d&&(b=d=this.subPixelOptimize(b,e.width)),new g({zlevel:this.getZlevelBase(),hoverable:!1,style:m.merge({xStart:a,yStart:b,xEnd:c,yEnd:d,lineType:e.type,strokeColor:e.color,lineWidth:e.width},e,!0)})},_buildBezierCurve:function(a,b,c,e){var f=d,g=e.orient,i=a.layout.position[0],j=a.layout.position[1],k=b.layout.position[0],l=b.layout.position[1],n=i,o=(l-j)*f+j,p=k,q=(l-j)*(1-f)+j;if("horizontal"===g)n=(k-i)*f+i,o=j,p=(k-i)*(1-f)+i,q=l;else if("radial"===g)if(a.id===this.tree.root.id)n=(k-i)*f+i,o=(l-j)*f+j,p=(k-i)*(1-f)+i,q=(l-j)*(1-f)+j;else{var r=a.layout.originPosition[0],s=a.layout.originPosition[1],t=b.layout.originPosition[0],u=b.layout.originPosition[1],v=this.tree.root.layout.position[0],w=this.tree.root.layout.position[1];n=r,o=(u-s)*f+s,p=t,q=(u-s)*(1-f)+s;var x=(n-this.minX)/this.width*Math.PI*2;n=o*Math.cos(x)+v,o=o*Math.sin(x)+w,x=(p-this.minX)/this.width*Math.PI*2,p=q*Math.cos(x)+v,q=q*Math.sin(x)+w}var y=new h({zlevel:this.getZlevelBase(),hoverable:!1,style:m.merge({xStart:i,yStart:j,cpX1:n,cpY1:o,cpX2:p,cpY2:q,xEnd:k,yEnd:l,strokeColor:c.color,lineWidth:c.width},c,!0)});this.shapeList.push(y)},_setTreeShape:function(a){var b=new i({nodePadding:a.nodePadding,layerPadding:a.layerPadding});this.tree.traverse(function(b){var c=[b.data,a],d=this.deepQuery(c,"symbolSize");"number"==typeof d&&(d=[d,d]),b.layout={width:d[0],height:d[1]}},this),b.run(this.tree);var c=a.orient,d=a.rootLocation.x,e=a.rootLocation.y,f=this.zr.getWidth(),g=this.zr.getHeight();d="center"===d?.5*f:this.parsePercent(d,f),e="center"===e?.5*g:this.parsePercent(e,g),e=this.parsePercent(e,g),"horizontal"===c&&(d=isNaN(d)?10:d,e=isNaN(e)?.5*g:e),"radial"===c?(d=isNaN(d)?.5*f:d,e=isNaN(e)?.5*g:e):(d=isNaN(d)?.5*f:d,e=isNaN(e)?10:e);var h=this.tree.root.layout.position[0];if("radial"===c){var j=1/0,k=0,l=0;this.tree.traverse(function(a){k=Math.max(k,a.layout.position[0]),j=Math.min(j,a.layout.position[0]),l=Math.max(l,a.layout.width)}),this.width=k-j+2*l,this.minX=j}this.tree.traverse(function(b){var f,g;if("vertical"===c&&"inverse"===a.direction)f=b.layout.position[0]-h+d,g=e-b.layout.position[1];else if("vertical"===c)f=b.layout.position[0]-h+d,g=b.layout.position[1]+e;else if("horizontal"===c&&"inverse"===a.direction)g=b.layout.position[0]-h+e,f=d-b.layout.position[1];else if("horizontal"===c)g=b.layout.position[0]-h+e,f=b.layout.position[1]+d;else{f=b.layout.position[0],g=b.layout.position[1],b.layout.originPosition=[f,g];var i=g,k=(f-j)/this.width*Math.PI*2;f=i*Math.cos(k)+d,g=i*Math.sin(k)+e,b.layout.angle=k}b.layout.position[0]=f,b.layout.position[1]=g},this)},refresh:function(a){this.clear(),a&&(this.option=a,this.series=this.option.series);for(var b=this.series,c=this.component.legend,d=0;d<b.length;d++)if(b[d].type===k.CHART_TYPE_TREE){b[d]=this.reformOption(b[d]);var e=b[d].name||"";if(this.selectedMap[e]=!c||c.isSelected(e),!this.selectedMap[e])continue;this._buildSeries(b[d],d)}},_buildSeries:function(a,b){this._buildShape(a,b)}},m.inherits(b,c),a("../chart").define("tree",b),b}),define("echarts2/layout/Tree",["require","zrender2/tool/vector"],function(a){function b(a){a=a||{},this.nodePadding=a.nodePadding||30,this.layerPadding=a.layerPadding||100,this._layerOffsets=[],this._layers=[]}var c=a("zrender2/tool/vector");return b.prototype.run=function(a){this._layerOffsets.length=0;for(var b=0;b<a.root.height+1;b++)this._layerOffsets[b]=0,this._layers[b]=[];this._updateNodeXPosition(a.root);var c=a.root;this._updateNodeYPosition(c,0,c.layout.height)},b.prototype._updateNodeXPosition=function(a){var b=1/0,d=-1/0;a.layout.position=a.layout.position||c.create();for(var e=0;e<a.children.length;e++){var f=a.children[e];this._updateNodeXPosition(f);var g=f.layout.position[0];g<b&&(b=g),g>d&&(d=g)}a.children.length>0?a.layout.position[0]=(b+d)/2:a.layout.position[0]=0;var h=this._layerOffsets[a.depth]||0;if(h>a.layout.position[0]){var i=h-a.layout.position[0];this._shiftSubtree(a,i);for(var e=a.depth+1;e<a.height+a.depth;e++)this._layerOffsets[e]+=i}this._layerOffsets[a.depth]=a.layout.position[0]+a.layout.width+this.nodePadding,this._layers[a.depth].push(a)},b.prototype._shiftSubtree=function(a,b){a.layout.position[0]+=b;for(var c=0;c<a.children.length;c++)this._shiftSubtree(a.children[c],b)},b.prototype._updateNodeYPosition=function(a,b,c){a.layout.position[1]=b;for(var d=0,e=0;e<a.children.length;e++)d=Math.max(a.children[e].layout.height,d);var f=this.layerPadding;"function"==typeof f&&(f=f(a.depth));for(var e=0;e<a.children.length;e++)this._updateNodeYPosition(a.children[e],b+f+c,d)},b});