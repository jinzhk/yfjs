!function(a,b){if("function"==typeof define&&define.amd)define("window",function(){return a}),define(["window","jquery","plupload"],b);else if("object"==typeof exports&&"undefined"!=typeof module){var c;try{c=require("jquery")}catch(b){if(!(c=a.jQuery))throw new Error("jQuery dependency not found")}var d;try{d=require("plupload")}catch(b){if(!(d=a.plupload))throw new Error("plupload dependency not found")}module.exports=b(a,c,d)}else{if(!a.jQuery)throw new Error("jQuery dependency not found");if(!a.plupload)throw new Error("plupload dependency not found");a.pluploadUI=b(a,a.jQuery,a.plupload)}}(this,function(a,b,c){function d(a){return c.translate(a)||a}function e(a){a.id=a.attr("id"),a.html('<div class="plupload_wrapper"><div class="plupload_container"><div class="plupload_choose"><div class="plupload_choice"><i class="fa fa-upload plupload_icon_choice"></i><button class="btn btn-info plupload_button_choice">'+d("Select files")+'</button></div><div class="plupload_dnd"><div class="plupload_dnd_area"><span>'+d("Drag files here.")+'</span></div></div></div><div class="plupload_buttons"><div class="pull-left"><a class="btn btn-success plupload_button_start"><i class="glyphicon glyphicon-circle-arrow-right"></i>&ensp;'+d("Start Upload")+'</a><a class="btn btn-default plupload_button_stop hidden"><i class="glyphicon glyphicon-minus-sign"></i>&ensp;'+d("Stop Upload")+'</a></div><div class="btn-group plupload_view_switch pull-right" data-toggle="buttons"><label class="btn btn-default"  for="'+a.id+'_view_thumbs" data-view="thumbs"><input type="radio" id="'+a.id+'_view_thumbs" name="view_mode_'+a.id+'" autocomplete="off" /><i class="fa fa-picture-o"></i><span class="sr-only">'+d("Thumbnails")+'</span></label><label class="btn btn-default" for="'+a.id+'_view_list" data-view="list"><input type="radio" id="'+a.id+'_view_list" name="view_mode_'+a.id+'" autocomplete="off" /><i class="fa fa-list"></i><span class="sr-only">'+d("List")+'</span></label></div></div><div class="plupload_preview"><ul class="plupload_preview_thumbs plupload_scroll"></ul><div class="plupload_preview_list"><div class="plupload_preview_list_header clearfix"><div class="pull-right"><b class="plupload_file_size">'+d("Size")+'</b><b class="plupload_file_status">'+d("Status")+'</b><b class="plupload_file_action">&emsp;</b></div><b class="plupload_file_name">'+d("Filename")+'</b></div><ul class="plupload_preview_list_body plupload_scroll clearfix"></ul></div></div><div class="plupload_status"><p class="plupload_status_text pull-left"><span class="plupload_upload_status">已上传 0/0 个文件</span>，共 <span class="plupload_total_size">0 B</span></p><div class="progress plupload_total_progress pull-right"><div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0"><span class="plupload_total_percent">0%</span></div></div></div></div><input class="plupload_count" value="0" type="hidden"></div>')}function f(a){var c=[];return this.each(function(){var d=b(this),e=d.data("bs.plupload.ui"),f="object"==typeof a&&a;e||d.data("bs.plupload.ui",e=new i(this,f)),"string"==typeof a?"function"==typeof e[a]&&c.push(e[a].call(e)):c.push(e)}),c<=1?c[0]:c}var g={};c.addI18n({"Select files":"点击选择文件","Drag files here.":"或者把文件拖到这里。","Remove file":"移除文件"});var h={browse_button_hover:"hover",browse_button_active:"active",filters:{},buttons:{browse:!0,start:!0,stop:!0},views:{list:!0,thumbs:!1,active:"list",remember:!0},thumb_width:120,thumb_height:120,multiple_queues:!0,dragdrop:!0,autostart:!1,sortable:!1,rename:!1},i=function(a,d){var f;this.FILE_COUNT_ERROR=-9001,this.$element=b(a),f=this.$element.attr("id"),f||(f=c.guid(),this.$element.attr("id",f)),this.id=f,this.contents_bak=this.$element.html(),e(this.$element),this.container=b(".plupload_container",this.$element).attr("id",f+"_container"),this.drop_area=b(".plupload_dnd_area",this.container),this.preview=b(".plupload_preview",this.container).attr("id",f+"_preview"),this.preview_thumbs=b(".plupload_preview_thumbs",this.container).attr("id",f+"_preview_thumbs"),this.preview_list_wrapper=b(".plupload_preview_list",this.container).attr("id",f+"_preview_list"),this.preview_list=b(".plupload_preview_list_body",this.preview_list_wrapper).attr("id",f+"_preview_list"),this.content=this.preview_thumbs,this.browse_button=b(".plupload_button_choice",this.container).attr("id",f+"_browse"),this.browse_button.add(b(".plupload_button_add",this.container).attr("id",f+"_add")),this.start_button=b(".plupload_button_start",this.container).attr("id",f+"_start"),this.stop_button=b(".plupload_button_stop",this.container).attr("id",f+"_stop"),this.thumbs_switcher=b("#"+f+"_view_thumbs"),this.list_switcher=b("#"+f+"_view_list"),b.fn.button&&(this.browse_button.button("disable"),this.start_button.button("disable")),this.status_bar=b(".plupload_status",this.container),this.progressbar=b(".plupload_total_progress",this.container),this.counter=b(".plupload_count",this.$element).attr({id:f+"_count",name:f+"_count"}),this.options=b.extend(!0,{},h,"object"==typeof d?d:null),this._initUploader()};i.prototype={_initUploader:function(){var a,e=this,f=this.id,h={container:f+"_buttons",browse_button:f+"_browse"};b(".plupload_buttons",this.$element).attr("id",f+"_buttons"),e.options.dragdrop&&(e.drop_area.attr("id",this.id+"_dropbox"),h.drop_element=this.id+"_dropbox"),a=this.uploader=g[f]=new c.Uploader(b.extend(this.options,h)),b.each(a.settings,function(a,b){e._setOption(a,b)}),e.options.views.thumbs&&(a.settings.required_features.display_media=!0),e.options.max_file_count&&c.extend(a.getOption("filters"),{max_file_count:e.options.max_file_count}),c.addFileFilter("max_file_count",function(a,b,c){a<=this.files.length-(this.total.uploaded+this.total.failed)?(e.browse_button.button("disable"),this.disableBrowse(),this.trigger("Error",{code:e.FILE_COUNT_ERROR,message:d("File count error."),file:b}),c(!1)):c(!0)}),a.bind("Error",function(a,b){var f,g="";switch(f="<strong>"+b.message+"</strong>",b.code){case c.FILE_EXTENSION_ERROR:g=o.sprintf(d("File: %s"),b.file.name);break;case c.FILE_SIZE_ERROR:g=o.sprintf(d("File: %s, size: %d, max file size: %d"),b.file.name,c.formatSize(b.file.size),c.formatSize(c.parseSize(a.getOption("filters").max_file_size)));break;case c.FILE_DUPLICATE_ERROR:g=o.sprintf(d("%s already present in the queue."),b.file.name);break;case e.FILE_COUNT_ERROR:g=o.sprintf(d("Upload element accepts only %d file(s) at a time. Extra files were stripped."),a.getOption("filters").max_file_count||0);break;case c.IMAGE_FORMAT_ERROR:g=d("Image format either wrong or not supported.");break;case c.IMAGE_MEMORY_ERROR:g=d("Runtime ran out of available memory.");break;case c.HTTP_ERROR:g=d("Upload URL might be wrong or doesn't exist.")}f+=" <br /><i>"+g+"</i>",e._trigger("error",null,{up:a,error:b}),b.code===c.INIT_ERROR?setTimeout(function(){e.destroy()},1):e.notify("error",f)}),a.bind("PostInit",function(a){e.options.buttons.browse?e.browse_button.button("enable"):(e.browse_button.button("disable").hide(),a.disableBrowse(!0)),e.options.buttons.start||e.start_button.button("disable").hide(),e.options.buttons.stop||e.stop_button.button("disable").hide(),!e.options.unique_names&&e.options.rename&&e._enableRenaming(),e.options.dragdrop&&a.features.dragdrop&&e.drop_area.addClass("plupload_dropbox"),e._enableViewSwitcher(),e.start_button.click(function(a){b(this).is(".disabled")||b(this).is(":disabled")||e.start(),a.preventDefault()}),e.stop_button.click(function(a){e.stop(),a.preventDefault()}),e._trigger("ready",null,{up:a})}),a.init(),a.bind("FileFiltered",function(a,b){e._addFiles(b)}),a.bind("FilesAdded",function(a,c){e._trigger("selected",null,{up:a,files:c}),e.options.sortable&&b.fn.sortable&&e._enableSortingList(),e._trigger("updatelist",null,{filelist:e.content}),e.options.autostart&&setTimeout(function(){e.start()},10)}),a.bind("FilesRemoved",function(a,c){b.fn.sortable&&e.options.sortable&&(e.preview_list.dragsort("destroy"),e.preview_thumbs.dragsort("destroy")),b.each(c,function(a,c){b('.plupload_file[data-id="'+c.id+'"]').toggle("highlight",function(){b(this).remove()})}),a.files.length?e.options.sortable&&b.fn.sortable&&e._enableSortingList():setTimeout(function(){e.preview.hide()},500),e._trigger("updatelist",null,{filelist:e.content}),e._trigger("removed",null,{up:a,files:c})}),a.bind("QueueChanged StateChanged",function(){e._handleState()}),a.bind("UploadFile",function(a,b){e._handleFileStatus(b)}),a.bind("FileUploaded",function(a,b){e._handleFileStatus(b),e._trigger("uploaded",null,{up:a,file:b})}),a.bind("UploadProgress",function(a,b){e._handleFileStatus(b),e._updateTotalProgress(),e._trigger("progress",null,{up:a,file:b})}),a.bind("UploadComplete",function(a,b){e._addFormFields(),e._trigger("complete",null,{up:a,files:b})})},_setOption:function(a,c){var d=this;"buttons"==a&&"object"==typeof c&&(c=b.extend(d.options.buttons,c),c.browse?(d.browse_button.button("enable").show(),d.uploader.disableBrowse(!1)):(d.browse_button.button("disable").hide(),d.uploader.disableBrowse(!0)),c.start?(d.start_button.show(),d.uploader&&d.uploader.files.length?d.start_button.button("enable"):d.start_button.button("disable")):d.start_button.button("disable").hide(),c.stop?d.stop_button.button("enable").show():d.stop_button.button("disable").hide()),d.uploader.settings[a]=c},_trigger:function(a,c,d){a="string"==typeof a?a.toLowerCase():"";var e,f,g=this.options["on"+a];if(d=d||{},c=b.Event(c),c.type=a,c.target=this.$element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.$element.trigger(c,d),!(b.isFunction(g)&&!1===g.apply(this.$element[0],[c].concat(d))||c.isDefaultPrevented())},start:function(){this.uploader.start(),this._trigger("start",null,{up:this.uploader})},stop:function(){this.uploader.stop(),this._trigger("stop",null,{up:this.uploader})},enable:function(){this.browse_button.button("enable"),this.uploader.disableBrowse(!1)},disable:function(){this.browse_button.button("disable"),this.uploader.disableBrowse(!0)},getFile:function(a){return"number"==typeof a?this.uploader.files[a]:this.uploader.getFile(a)},getFiles:function(){return this.uploader.files},removeFile:function(a){"string"===c.typeOf(a)&&(a=this.getFile(a)),this.uploader.removeFile(a)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},notify:function(a,c){var d=b('<div class="plupload_message_layer fade"><div class="alert alert-danger plupload_message"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><i class="fa fa-bug plupload_message_icon"></i><p class="plupload_message_content">'+c+"</p></div></div>");this.container.append(d);var e=function(){d.removeClass("in"),setTimeout(function(){d.remove()},200)};d.find(".close").click(function(){e()}).end().click(function(a){b.contains(b(".plupload_message",d)[0],a.target)||a.target===b(".plupload_message",d)[0]||e()}),setTimeout(function(){d.addClass("in")},200)},destroy:function(){this.uploader.destroy(),b(".btn",this.$element).unbind(),this.$element.empty().html(this.contents_bak),this.contents_bak=""},_handleState:function(){var a=this.uploader,e=a.files.length-(a.total.uploaded+a.total.failed),f=a.getOption("filters").max_file_count||0;c.STARTED===a.state?(b([]).add(this.stop_button).add(".plupload_started").removeClass("hidden"),this.start_button.button("disable"),this.options.multiple_queues||(this.browse_button.button("disable"),a.disableBrowse())):c.STOPPED===a.state&&(b([]).add(this.stop_button).add(".plupload_started").addClass("hidden"),e?this.start_button.button("enable"):this.start_button.button("disable"),this.options.multiple_queues&&f&&f>e&&(this.browse_button.button("enable"),a.disableBrowse(!1)),this._updateTotalProgress()),this.status_bar.find(".plupload_total_num").html(a.files.length).end().find(".plupload_total_size").html(c.formatSize(a.total.size).toUpperCase()).end().find(".plupload_upload_status").html(o.sprintf(d("Uploaded %d/%d files"),a.total.uploaded,a.files.length)),a.refresh()},_handleFileStatus:function(a){var d,e=b('.plupload_file[data-id="'+a.id+'"]',this.content);if(e.length){var f="list"===this.view_mode?e.find(".plupload_file_status"):e.find(".plupload_file_status_text");switch(e.find(".close").removeClass("disabled"),a.status){case c.DONE:if(d="plupload_done",e.hasClass(d))break;f.html("已成功上传");break;case c.FAILED:if(d="plupload_failed",e.hasClass(d))break;f.html("上传失败");break;case c.QUEUED:if(d="plupload_delete",e.hasClass(d))break;f.html("准备上传");break;case c.UPLOADING:if(d="plupload_uploading",e.find(".close").addClass("disabled"),e.hasClass(d))break;f.html(a.percent+"%");var g=this.content,h=g.scrollTop(),i=g.height(),j=e.position().top+e.height();i<j&&g.scrollTop(h+j-i)}a.status==c.FAILED?e.find(".plupload_file_percent").html("100%").end().find(".plupload_file_progress > .progress-bar").attr("aria-valuenow",100).css("width","100%").end().find(".plupload_file_size").html(c.formatSize(a.size)):a.status!=c.QUEUED&&e.find(".plupload_file_percent").html(a.percent+"%").end().find(".plupload_file_progress > .progress-bar").attr("aria-valuenow",a.percent).css("width",a.percent+"%").end().find(".plupload_file_size").html(c.formatSize(a.size)),d&&!e.hasClass(d)&&e.removeClass(["plupload_done","plupload_failed","plupload_delete","plupload_uploading"].join(" ")).addClass(d)}},_updateTotalProgress:function(){var a=this.uploader,d=0;if(this.preview[0].scrollTop=this.preview[0].scrollHeight,a.total.failed||a.total.uploaded){var e=0,f=0;b.each(a.files,function(a,b){b.status!=c.FAILED&&(e+=b.origSize,f+=b.origSize*b.percent/100)}),d=e>0?f/e*100:0}else d=a.total.percent;this.progressbar.find(".progress-bar").attr("aria-valuenow",d).css("width",d+"%").removeClass("progress-bar-info progress-bar-success").addClass(d>=100?"progress-bar-success":"progress-bar-info").end().find(".plupload_total_percent").html(Math.round(d)+"%")},_displayThumbs:function(){function a(a,b,c){var d;a&&a.on(b,function(){clearTimeout(d),d=setTimeout(function(){clearTimeout(d),c()},300)})}function c(){if(!h||!i){var a=b(".plupload_file:eq(0)",k.preview_thumbs);h=a.outerWidth(!0),i=a.outerHeight(!0)}var c=k.content.width(),d=k.content.height();j=Math.floor(c/h),l=j*(Math.ceil(d/i)+1)}function d(){var a=Math.floor(k.content.scrollTop()/i)*j;m=b(".plupload_file",k.preview_thumbs).slice(a,a+l).filter(".plupload_thumb_toload").get()}function e(){function e(){"thumbs"===k.view_mode&&(c(),d(),g())}b.fn.resizable&&a(k.container,"resize",e),a(k.window,"resize",e),a(k.content,"scroll",e),k.$element.on("viewchanged selected",e),e()}function f(a,c){var d=new o.Image,e=b('.plupload_file[data-id="'+a.id+'"]',k.preview_thumbs);d.onload=function(){var a=b(".plupload_file_thumb",e);this.embed(a[0],{width:k.options.thumb_width,height:k.options.thumb_height,resample:"bicubic",swf_url:o.resolveUrl(k.options.flash_swf_url||k.uploader.settings.flash_swf_url),xap_url:o.resolveUrl(k.options.silverlight_xap_url||k.uploader.settings.silverlight_xap_url)})},d.bind("embedded error",function(a){e.removeClass("plupload_thumb_loading").addClass("plupload_thumb_"+a.type),this.destroy(),setTimeout(c,1)}),e.removeClass("plupload_thumb_toload").addClass("plupload_thumb_loading"),d.load(a.getSource())}function g(){"thumbs"!==k.view_mode||n||(d(),m.length&&(n=!0,f(k.getFile(b(m.shift()).data("id")),function(){n=!1,g()})))}var h,i,j,k=this,l=0,m=[],n=!1;this.options.views.thumbs&&this.$element.on("selected",function a(){k.$element.off("selected",a),e()})},_addFiles:function(a){var e=this;"array"!==c.typeOf(a)&&(a=[a]);var f=function(d){var f,g="";return d?(b.each(a,function(a,b){f=o.Mime.getFileExtension(b.name)||"none",g+=d.replace(/\{(\w+)\}/g,function(a,d){switch(d){case"thumb_width":case"thumb_height":return e.options[d];case"size":return c.formatSize(b.size);case"ext":return f;default:return b[d]||""}})}),g):g},g=function(){return'<li class="plupload_file plupload_delete plupload_thumb_toload" data-id="{id}" style="width:{thumb_width}px;"><div class="plupload_file_thumb" data-file-ext="{ext}" style="width: {thumb_width}px; height: {thumb_height}px; line-height: {thumb_height}px;"></div><div class="progress plupload_file_progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0;"><span class="plupload_file_percent sr-only">{percent}</span></div></div><div class="plupload_file_layer"><div class="plupload_file_status"><button type="button" class="close" title="'+d("Remove file")+'"><i class="glyphicon glyphicon-remove-circle"></i></button><i class="fa fa-spinner fa-spin plupload_file_icon_spin hidden"></i><span class="plupload_file_status_text">准备上传</span></div><div class="plupload_file_info"><h5 class="plupload_file_name" title="{name}">{name}</h5><em class="plupload_file_size">{size}</em></div></div><div class="plupload_file_fields hidden"></div></li>'},h=function(){return'<li class="plupload_file plupload_delete" data-id="{id}"><div class="pull-right"><span class="plupload_file_size">{size}</span><span class="plupload_file_status">准备上传</span><span class="plupload_file_action"><button type="button" class="close" title="'+d("Remove file")+'"><i class="glyphicon glyphicon-remove-circle"></i></button><i class="fa fa-spinner fa-spin plupload_file_icon_spin hidden"></i></span></div><span class="plupload_file_name">{name}</span><div class="plupload_file_fields hidden"></div></li>'},i="";e.options.views.thumbs&&(i=f(g()),e.preview_thumbs.append(i),b(".plupload_file",e.preview_thumbs).off("mouseover mouseleave").on("mouseover",function(){b(this).find(".plupload_file_layer").addClass("in")}).on("mouseleave",function(){b(this).find(".plupload_file_layer").removeClass("in")})),e.options.views.list&&(i=f(h()),e.preview_list.append(i)),e.preview.is(":hidden")&&e.preview.show(),e.browse_button.removeClass(e.uploader.settings.browse_button_active),b(".plupload_file .close",e.preview).off("click.remove").on("click.remove",function(a){a.preventDefault(),e.removeFile(b(a.target).closest(".plupload_file").data("id"))})},_addFormFields:function(){var a=this;b(".plupload_file_fields",this.preview).html(""),c.each(this.uploader.files,function(d,e){var f="",g=a.id+"_"+e;d.target_name&&(f+='<input type="hidden" name="'+g+'_tmpname" value="'+c.xmlEncode(d.target_name)+'" />'),f+='<input type="hidden" name="'+g+'_name" value="'+c.xmlEncode(d.name)+'" />',f+='<input type="hidden" name="'+g+'_status" value="'+(d.status===c.DONE?"done":"failed")+'" />',b('.plupload_file[data-id="'+d.id+'"]',this.content).find(".plupload_file_fields").html(f)}),this.counter.val(this.uploader.files.length)},_viewChanged:function(a){var c=this;this.view_mode=a,this.options.views.remember&&b.cookie&&b.cookie("plupload_ui_view",a,{expires:7,path:"/"}),this.content=this["preview_"+a]||this.preview_thumbs,"IE"===o.Env.browser&&o.Env.version<7&&this.content.attr("style",'height:expression(document.getElementById("'+this.id+'_container").clientHeight - '+("list"===a?132:102)+")"),this.container.removeClass("plupload_view_list plupload_view_thumbs").addClass("plupload_view_"+a),this._trigger("viewchanged",null,{view:a}),b.each(this.uploader.files,function(a,b){c._handleFileStatus(b)})},_enableViewSwitcher:function(){var a,d,e,f=this,g=b(".plupload_view_switch",this.container);c.each(["list","thumbs"],function(a){f.options.views[a]||g.find('[for="'+f.id+"_view_"+a+'"]').remove()}),d=g.find(".btn"),1===d.length?(g.hide(),a=d.eq(0).data("view"),this._viewChanged(a)):b.fn.button&&d.length>1?(this.options.views.remember&&b.cookie&&(a=b.cookie("plupload_ui_view")),~c.inArray(a,["list","thumbs"])||(a=this.options.views.active),e=g.find('[for="'+f.id+"_view_"+a+'"]'),e.addClass("active").find("input").prop("checked",!0),g.show().button().find("input").on("change",function(c){c.preventDefault(),a=b(this).closest("label").data("view"),f._viewChanged(a)}),this._viewChanged(a)):(d.length>1&&g.show(),this._viewChanged(this.options.views.active)),this.options.views.thumbs&&this._displayThumbs();var h=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",f.container.append(a);var b=a.offsetWidth-a.clientWidth;return f.container[0].removeChild(a),b};this.options.views.list&&b(".plupload_preview_list_header",f.preview_list_wrapper).css("padding-right",h()+"px")},_enableRenaming:function(){var a=this;this.preview.dblclick(function(c){var d,e,f,g,h=b(c.target),i="";h.hasClass("plupload_file_name_wrapper")&&(e=a.uploader.getFile(h.closest(".plupload_file")[0].id),g=e.name,f=/^(.+)(\.[^.]+)$/.exec(g),f&&(g=f[1],i=f[2]),d=b('<input class="plupload_file_rename" type="text" />').width(h.width()).insertAfter(h.hide()),d.val(g).blur(function(){h.show().parent().scrollLeft(0).end().next().remove()}).keydown(function(a){var c=b(this);-1!==b.inArray(a.keyCode,[13,27])&&(a.preventDefault(),13===a.keyCode&&(e.name=c.val()+i,h.html(e.name)),c.blur())})[0].focus())})},_enableSortingList:function(){var a=this;b(".plupload_file",this.content).length<2||(this._disableSortingList(),this.content.dragsort({dragSelector:"li",dragBetween:!1,placeHolderTemplate:'<li class="plupload_file_placeholder"></li>',dragEnd:function(){var c=[];b(".plupload_file",a.content).each(function(d){c[c.length]=a.uploader.getFile(b(this).attr("id"))}),c.unshift(c.length),c.unshift(0),Array.prototype.splice.apply(a.uploader.files,c)}}))},_disableSortingList:function(a){var b=this;a?b["preview_"+a]&&b["preview_"+a].dragsort("destroy"):c.each(["list","thumbs"],function(a){b["preview_"+a]&&b["preview_"+a].dragsort("destroy")})}};var j=b.fn.plupload;b.fn.plupload=f,b.fn.plupload.Constructor=i,b.fn.plupload.noConflict=function(){return b.fn.plupload=j,this}});